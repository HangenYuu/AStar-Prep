# Visualization
## NGLview
```python
import nglview as ng

view = ng.show_structure_file("input/1fjs.pdb")
view.add_representation(repr_type='ball+stick', selection='SOL')
view.add_representation(repr_type='spacefill', selection='NA')
view.add_representation(repr_type='spacefill', selection='CL')
view.camera='orthographic'
view.center()
view
```
## mdtraj
Load the `.xtc` trajectory generated by GROMACS for visualization with NGLview
```python
import mdtraj as md

traj = md.load("md_center.xtc", top="1fjs_newbox.gro")
view = ng.show_mdtraj(traj)
view
```
It will be a cartoon that can be played in Jupyter Notebook.
# GROMACS
GROMACS are divided into many modules for different steps in the workflows. The beginner pack contains
- `gmx pdb2gmx` to preprocess the data.
- `gmx editconf` to define simulation box.
- `gmx solvate` to define solvation conditions e.g., water.
- `gmx genion` to populate ions e.g., Na⁺, Cl⁻.
- `gmx grompp` to preprocess & validate input files.
- `gmx mdrun` to actually run the MD simulation.
- `gmx energy` to analyze thermodynamics properties of the result system.
- `gmx wham` to analyze the results of umbrella sampling.

> The most troublesome thing would be the need to modify the .mdp file myself for every simulation run. I can follow the online tutorials or templates likely already in use by my colleagues and supervisors. But I still need to learn what are the parameters to use from the documentation so that I can edit it on my own.

**The below comes from the official documentation & tutorial 1**
## `gmx pdb2gmx`

**Basic command structure**:
```bash
gmx pdb2gmx -f input.pdb -o output.gro -water tip3p -ff charmm27
```

**Required options**:
- `-f <file>`: Input PDB file (required)
- `-o <file>`: Output structure file (.gro)

**Common options**:
- `-p <file>`: Output topology file (default: topol.top)
- `-i <file>`: Output include topology file
- `-water <enum>`: Water model (none, spc, spce, tip3p, tip4p, tip5p, tips3p)
- `-ff <string>`: Force field selection
- `-ignh`: Ignore hydrogen atoms in input file
- `-ter`: Interactively assign charge states for termini
- `-inter`: Interactively assign charge states for ionizable residues
- `-missing`: Continue when atoms are missing

**Complete example**:
```bash
gmx pdb2gmx -f protein.pdb -o protein_processed.gro -p topol.top -water tip3p -ff charmm27 -ignh
```

## `gmx editconf`

**Basic command structure**:
```bash
gmx editconf -f input.gro -o output.gro -c -d 1.0 -bt dodecahedron
```

**Required options**:
- `-f <file>`: Input structure file (required)
- `-o <file>`: Output structure file

**Common options**:
- `-c`: Center the system in the box
- `-d <real>`: Distance between solute and box edge (nm)
- `-bt <enum>`: Box type (triclinic, cubic, dodecahedron, octahedron)
- `-box <vector>`: Box dimensions
- `-center <vector>`: Center of geometry
- `-angles <vector>`: Box angles (for triclinic)
- `-princ`: Orient molecule along principal axes
- `-scale <vector>`: Scale the coordinates

**Complete example**:
```bash
gmx editconf -f protein.gro -o protein_newbox.gro -c -d 1.0 -bt dodecahedron
```

## `gmx solvate`

**Basic command structure**:
```bash
gmx solvate -cp solute.gro -cs spc216.gro -o solvated.gro -p topol.top
```

**Required options**:
- `-cp <file>`: Input solute configuration file
- `-cs <file>`: Input solvent configuration file

**Common options**:
- `-o <file>`: Output solvated structure file
- `-p <file>`: Topology file to be modified
- `-box <vector>`: Box dimensions (if not using -cp box)
- `-radius <real>`: Default van der Waals radius (0.105 nm)
- `-scale <real>`: Scale factor for van der Waals radii (0.57)
- `-shell <real>`: Optional water shell around solute
- `-maxsol <int>`: Maximum number of solvent molecules

**Complete example**:
```bash
gmx solvate -cp protein_newbox.gro -cs spc216.gro -o protein_solv.gro -p topol.top
```

## `gmx genion`

**Basic command structure**:
```bash
printf "SOL\n" | gmx genion -s input.tpr -o output.gro -p topol.top -pname NA -nname CL -neutral
```

**Required options**:
- `-s <file>`: Input run file (.tpr) (required)
- `-o <file>`: Output structure file

**Common options**:
- `-p <file>`: Topology file to be modified
- `-n <file>`: Index file
- `-neutral`: Add ions to neutralize the system
- `-conc <real>`: Salt concentration (mol/liter)
- `-pname <string>`: Positive ion name (default: NA)
- `-nname <string>`: Negative ion name (default: CL)
- `-np <int>`: Number of positive ions
- `-nn <int>`: Number of negative ions
- `-pq <int>`: Charge of positive ion (default: 1)
- `-nq <int>`: Charge of negative ion (default: -1)
- `-rmin <real>`: Minimum distance between ions and non-solvent (0.6 nm)
- `-seed <int>`: Random seed

**Complete example**:
```bash
printf "SOL\n" | gmx genion -s ions.tpr -o system_ions.gro -p topol.top -pname NA -nname CL -neutral -conc 0.15
```

## `gmx grompp`

**Basic command structure**:
```bash
gmx grompp -f input.mdp -c coords.gro -p topol.top -o output.tpr
```

**Required options**:
- `-f <file>`: Input parameter file (.mdp) (required)
- `-c <file>`: Input coordinate file (required)
- `-p <file>`: Input topology file (required)
- `-o <file>`: Output run file (.tpr)

**Common options**:
- `-r <file>`: Restraint coordinate file
- `-rb <file>`: B-state coordinate file (for free energy)
- `-n <file>`: Index file
- `-t <file>`: Input trajectory/checkpoint file
- `-e <file>`: Input energy file
- `-maxwarn <int>`: Maximum number of warnings (default: 0)
- `-v`: Verbose output
- `-time <real>`: Take frame at specified time
- `-po <file>`: Output processed parameter file

**Complete example**:
```bash
gmx grompp -f md.mdp -c equilibrated.gro -r equilibrated.gro -p topol.top -n index.ndx -o md.tpr -maxwarn 1
```

## `gmx mdrun`

**Basic command structure**:
```bash
gmx mdrun -v -deffnm simulation_name
```

**Required options**:
- `-s <file>`: Input run file (.tpr) (can be implied with -deffnm)

**Common options**:
- `-deffnm <string>`: Default filename prefix for all I/O
- `-v`: Verbose output
- `-ntmpi <int>`: Number of thread-MPI ranks
- `-ntomp <int>`: Number of OpenMP threads per MPI rank
- `-gpu_id <string>`: GPU device IDs to use
- `-pin <enum>`: Pin threads to cores (auto, on, off)
- `-pinoffset <int>`: Core offset for pinning
- `-pinstride <int>`: Stride for pinning
- `-maxh <real>`: Terminate after maximum hours
- `-cpi <file>`: Checkpoint file for continuation
- `-append`: Append to output files
- `-noappend`: Do not append to output files
- `-cpo <file>`: Output checkpoint file
- `-o <file>`: Output trajectory file
- `-x <file>`: Output compressed trajectory
- `-e <file>`: Output energy file
- `-g <file>`: Output log file

**Complete examples**:
```bash
# Basic run
gmx mdrun -v -deffnm md -ntmpi 1 -ntomp 8

# With time limit and checkpoint continuation
gmx mdrun -v -deffnm md -maxh 24 -cpi md.cpt -append

# Multiple simulations
gmx mdrun -v -deffnm md -multidir run1 run2 run3 -ntmpi 1 -ntomp 4
```

## `gmx energy`

**Basic command structure**:
```bash
echo "Temperature" | gmx energy -f input.edr -o temperature.xvg
```

**Required options**:
- `-f <file>`: Input energy file (.edr) (required)

**Common options**:
- `-o <file>`: Output data file (.xvg)
- `-xvg <enum>`: XVG plot formatting (xmgrace, none)
- `-b <real>`: First frame time to read
- `-e <real>`: Last frame time to read
- `-dt <real>`: Only use frame when t MOD dt = first time
- `-w`: View output file
- `-fee`: Calculate free energy estimates
- `-fetemp <real>`: Reference temperature for free energy
- `-zero`: Set energy of first frame to zero
- `-sum`: Sum the energy terms selected
- `-dp`: Print energies in high precision
- `-aver`: Print average and standard deviation
- `-nmol <int>`: Number of molecules in system
- `-fluct_props`: Compute properties based on energy fluctuations

**Complete examples**:
```bash
# Extract temperature
echo "Temperature" | gmx energy -f md.edr -o temperature.xvg -xvg none -b 10

# Extract multiple properties
printf "Potential\nKinetic-En\nTemperature\n0\n" | gmx energy -f md.edr -o energies.xvg

# Extract pressure and density
printf "Pressure\nDensity\n0\n" | gmx energy -f npt.edr -o press_dens.xvg -b 50
```
> Better to run this once in the terminal, read all the possible options once to remember.

## `gmx wham`

**Basic command structure**:
```bash
gmx wham -it tpr-files.dat -ix pullx-files.dat -o profile.xvg -hist histogram.xvg
```

**Required options**:
- One of the following input combinations:
  - `-it <file>` + `-ix <file>`: TPR files list + pullx files list
  - `-it <file>` + `-if <file>`: TPR files list + pullf files list
  - `-ip <file>`: PDO files list

**Common options**:
- `-o <file>`: Output PMF profile (.xvg)
- `-hist <file>`: Output histograms (.xvg)
- `-oiact <file>`: Output integrated autocorrelation times
- `-bsres <file>`: Output bootstrap results
- `-bsprof <file>`: Output bootstrap profiles
- `-bins <int>`: Number of bins for analysis
- `-temp <real>`: Temperature (K)
- `-tol <real>`: Tolerance for convergence
- `-min <real>`: Minimum coordinate value
- `-max <real>`: Maximum coordinate value
- `-auto`: Automatic determination of boundaries
- `-b <real>`: First time to read from trajectory
- `-e <real>`: Last time to read from trajectory
- `-dt <real>`: Time step for reading trajectory
- `-unit <enum>`: Energy units (kJ, kCal, kT)
- `-zprof0 <real>`: Define profile to 0.0 at this position
- `-cycl`: Create cyclic/periodic profile
- `-sym`: Symmetrize profile around z=0
- `-log`: Write energy output (default)
- `-nolog`: Write probability output
- `-ac`: Calculate integrated autocorrelation times
- `-nBootstrap <int>`: Number of bootstrap samples for error estimation

**Complete examples**:
```bash
# Basic WHAM analysis
gmx wham -it tpr-files.dat -ix pullx-files.dat -o pmf.xvg -hist hist.xvg -temp 300 -bins 200

# With bootstrap error analysis
gmx wham -it tpr-files.dat -if pullf-files.dat -o pmf.xvg -hist hist.xvg -unit kJ -nBootstrap 200 -temp 300

# For periodic coordinate
gmx wham -it tpr-files.dat -ix pullx-files.dat -o pmf.xvg -hist hist.xvg -cycl -temp 300
```

## File List Format Examples

For `gmx wham`, you need to create file lists:

**tpr-files.dat**:
```
umbrella0.tpr
umbrella1.tpr
umbrella2.tpr
...
```

**pullx-files.dat**:
```
umbrella0_pullx.xvg
umbrella1_pullx.xvg
umbrella2_pullx.xvg
...
```