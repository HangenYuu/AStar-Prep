# CS279
## Topics
- Biomolecular structure prediction
- Molecular dynamics simulations
- Protein design
- Ligand docking & virtual screening
# Biomolecular structure
- The sequence of amino acids in a protein (usually) suffices to determine its structure as the chain often fold spontaneously into a preferred structure a.k.a “native structure” due to atomic force interactions.
- We can <mark style="background: #FFF3A3A6;">approximate the total potential energy of a molecular system as a sum of individual contributions</mark> (most intuitive and easiest to understand choice). Terms are additive.
	- Thus force on each atom is also a sum of individual contributions. **Remember**: force is the derivative of energy.
- Think of atoms as balls and forces as springs.
- Two types of forces: (covalently) bond and non-bonded.
- Approximating molecular structures as balls and springs, a molecule can be defined by its bond lengths, bond angles, and torsion angles.
- **Bonded**: each bond length and angle has some natural value that energy will need to be spent to move out of. Torsion angles have several preferred values.
- **Non-bonded**:
	- **Electrostatic force**: Based on the charge, atoms will repel or attract each other. The more extreme the better.
	- **van der Waals interactions**: For all pairs of atoms, they want to be at a comfortable distance from each other. Too close will repel, too far will attract. **Very week interactions**.
	- **Hydrogen bond**: Favorable interaction between an electronegative atom (e.g., N or O) and a hydrogen bound to another electronegative atom. Stronger than van der Waals' forces, but weaker than electrostatic forces.
	- **Disulfide bond**: Inside cellular environment, cysteine can form and break the disulfide bond easily. **That's why it can be a choice to force the shape of certain drugs**.
- The protein backbone is described with 2 torsion angles $\phi$ for N-C$\alpha$ bond and $\psi$ for C$\alpha$-C bond. The peptide N-C bond torsion angle $\omega$ is rigid due to its partial double bond properties.
- Due to steric effects, not all ($\phi$, $\psi$) combinations are possible. **Ramachandran plot** shows the probability distribution of all combinations, with cluster(s) of optimal energy conformations.
# Energy functions & conformation
- Atoms do not stay still but move around a lot. In the process, the 3D shape of a biomolecule can change. We refer to each geometry of a molecule as a conformation.
- The big question in computational biology is given a biomolecule, which confirmations will it adopt? How frequently will it adopt each confirmation?
- This depends on the other molecules surrounding it, so we typically consider a “molecular system” consisting of multiple molecules.
- Among the possible conformations, the system will adopt low energy conformations more frequently than high energy conformations. If we can define the energy associated with each conformation, we can determine how often the system will adopt each conformation. Hence, we need to know how to calculate energies for conformations of biomolecules or biomolecular systems.
- **Specify atom positions**: For a molecular system with $N$ atoms, you can specify the position of all atoms by a single vector $\mathbf{x}$ of length 3$N$, specifying the $x$, $y$, and $z$ coordinates of every atom.
- The total potential energy of a system of atoms as a function of all their positions ($\mathbf{x}$) is called the potential energy function $U(\mathbf{x})$. $U$ is also called a **force field** because one can use it to compute forces on atoms.
- The lecture focuses on **molecular mechanics force fields** which are often used for molecular simulations. These are more towards the physics-based, all-atom end. There are other force fields that are knowledge based, which are based on statistics about, for example, known protein structures.
$$
\begin{aligned}
&\text { A typical molecular mechanics force field }\\
&\begin{aligned}
U & =\sum_{\text {bonds }} k_b\left(b-b_0\right)^2 & & \text { Bond lengths ("Stretch") } \\
& +\sum_{\text {angles }} k_\theta\left(\theta-\theta_0\right)^2 & & \text { Bond angles ("Bend") } \\
& +\sum_{\text {torsions }} \sum_n k_{\phi, n}\left[1+\cos \left(n \phi-\phi_n\right)\right] & & \begin{array}{c}
\text { Torsional/dihedral angles }
\end{array} \\
& +\sum_i \sum_{j>i} \frac{q_i q_j}{r_{i j}} & & \text { Electrostatics } \\
& +\sum_i \sum_{j>i} \frac{A_{i j}}{r_{i j}^{12}}-\frac{B_{i j}}{r_{i j}^6} & & \text { Van der Waals }
\end{aligned}
\end{aligned}
$$
- **Boltzmann Distribution**: relates the potential energy of a particular arrangement of items to the probability of observing that arrangement of items at equilibrium.
$$
p(\mathbf{x})=\frac{1}{Z} \exp \left(\frac{-U(\mathbf{x})}{k_B T}\right)
$$
![[Pasted image 20250716204440.png]]
- Key properties:
	- Higher energy gives lower probability.
	- Exponential relationship: as energy increases, probability goes down quickly.
	- Temperature dependence: increasing temperature decreases differences in probability between high-energy and low-energy conformations.
- We don't care about the probability that all the atoms of a protein (or other biomolecules) and all the surrounding water atoms will be in one precise arrangement. Instead, we care about the probability that protein atoms will be in some *approximate* or *average* arrangement with any arrangement of surrounding water molecules. These positions are represented by a distinct probability region in the Boltzmann distribution density plot or wells in the potential energy plots.
-  To get probability of a confirmation state, we need to integrate over all confirmation within it.
- When assigning energy to conformational state, it is called free energy $G_{A}$ and it is analogous to Boltzmann distribution formula. Free energy is for conformational state what potential energy is for an individual conformation. 
- Free energy can be measured in terms of enthalpy $H$ and entropy $S$. The entropy of a conformational state is the number of conformations in that state (roughly speaking).
- Molecules will adopt conformational state with the minimum free energy. Wide, shallow wells often win over narrow, deep ones. This also depends on temperature. At room or body temperature, the conformational state of minimum free energy is usually very different different from the conformation with minimum potential energy.
- The most common measure of the similarity/difference between two structures of the same molecule is root mean squared deviation (RMSD), defined as
$$\sqrt{\frac{1}{N} \sum_{i=1}^{3 N}\left(\mathbf{x}_i-\mathbf{w}_i\right)^2}$$
- We generally want to align the structures, which can be done by finding the rigid-body rotation and translation of one structure that will minimize its RMSD from the other. The relevant measure of similarity is RMSD after alignment.
# Molecular dynamics
-  We want to mimic what atoms do in real life assuming a given potential energy function. The energy function allows us to calculate the force experienced by any atom given the position of the other atoms. Newton's laws tell us how those forces will affect the motions of the atoms.
- **Basic algorithm**: Discretize the time into steps, each step no more than a few femtoseconds (1 fs = 10<sup>–15</sup> s). At each step, we compute the forces acting on each atom using a molecular mechanics force field. Then we move the items a little bit to update the position and velocity of each item using Newton's Laws of Motion.
- **Calculating forces on atoms**: To determine the force on an atom, consider how quickly the potential energy of the system changes as you move that atom a tiny bit in each direction without moving any other atom. The faster the energy changes, the larger the force. The force is in the direction of decreasing energy.
- Force on atom $i$ is given by derivatives of $U$ with respect to the atom’s coordinates $x_{i}$, $y_{i}$, and $z_{i}$: $F(x) = -\nabla U(x)$. At local minima of the energy $U$ all forces are zero.
- A single vector $F$ specifies the force acting on every atom in the system. 
$$
\mathbf{X} = \begin{pmatrix}
x_1 \\
y_1 \\
z_1 \\
x_2 \\
y_2 \\
z_2 \\
\vdots \\
x_N \\
y_N \\
z_N
\end{pmatrix},
\quad
\mathbf{F} = \begin{pmatrix}
F_{1,x} \\
F_{1,y} \\
F_{1,z} \\
F_{2,x} \\
F_{2,y} \\
F_{2,z} \\
\vdots \\
F_{N,x} \\
F_{N,y} \\
F_{N,z}
\end{pmatrix}
= \begin{pmatrix}
\frac{\partial U}{\partial x_1} \\
\frac{\partial U}{\partial y_1} \\
\frac{\partial U}{\partial z_1} \\
\frac{\partial U}{\partial x_2} \\
\frac{\partial U}{\partial y_2} \\
\frac{\partial U}{\partial z_2} \\
\vdots \\
\frac{\partial U}{\partial x_N} \\
\frac{\partial U}{\partial y_N} \\
\frac{\partial U}{\partial z_N}
\end{pmatrix}
$$
(gradient is calculated for the case of increasing in each direction.)
- **Equations of Motion**: Newton's Second Law: $\mathbf{F} = m\mathbf{a}$. The equations of motions are
$$
\begin{cases}
\frac{dx}{dt} = v \\
\frac{dv}{dt} = \frac{F(x)}{m}
\end{cases}
$$
These equations are impossible to solve analytically, hence numerical methods are required.
The standard Euler scheme is:
$$
\begin{cases}
    \mathbf{x}_{i+1} &= \mathbf{x}_i + \delta_t \mathbf{v}_i \\
    \mathbf{v}_{i+1} &= \mathbf{v}_i + \delta_t F(\mathbf{x}_i) / \mathbf{m}
\end{cases}
$$
For long-term stability, more symmetric integration methods are preferred such as Verlet's:
$$
\begin{cases}
    \mathbf{x}_{i+1} &= \mathbf{x}_{i} + \delta_t \mathbf{v}_{i+1/2} \\
    \mathbf{v}_{i+1/2} &= \mathbf{v}_{i-1/2} + \delta_t F(\mathbf{x}_i) / \mathbf{m}
\end{cases}
$$
## Key properties of MD simulations
- **Atoms never stop jiggling**. Given enough time, the simulation samples the Boltzmann distribution. That is, the probability of a particular arrangement of atoms is a function of the potential energy.
- **Energy conservation**.Total energy (potential + kinetic) should be conserved. In practice total energy tends to grow slowly with time due to numerical errors. So one usually adds a mechanism to keep the temperature roughly constant AKA a thermostat to simulations.
- **Water is important**. Ignoring the solvent or the molecules surrounding the molecule of interest often leads to major artifacts. There are two options for taking solvent into account.
	- **Explicitly represent solvent molecules**. More computationally expensive but more accurate. Usually assume periodic boundary conditions.
	- **Implicit solvent**. Mathematical model to approximate average effects of solvent. Less accurate but faster.
# Limitations of MD simulations
- **Timescales**: Simulations require short time steps for numerical stability $\approx 2\times 10^{-15}$s while structural changes in proteins can take much longer, at least nanoseconds $10^{-9}$s. GPUs allow simulation of several microseconds but simulation timescales remain a challenge.
- **Force field accuracy**: Molecular mechanics force fields are inherently approximations. They have improved substantially over time, but various limitations remain. In practice, one needs some experience to know what to trust in a simulation (as is the case for many experimental methods).
- **MD simulations do not account for covenant bonds breakages and formations**:  A few covalent bonds do form and break more frequently in real life, such as disulfide bonds between cysteines and acidic or basic amino acid residues.